Resources:
  # You still need the ability to carry out the resource actions in the template.
  CloudFormationFullAccess:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: CloudFormationFullAccess
      PolicyDocument: {
        "Version":"2012-10-17",
        "Statement":[
          {
            "Effect":"Allow",
            "Action": "cloudformation:*",
            "Resource":"*"
          }
        ]
      }

  # dev
  OrganizationAccountAccessServerlessDevPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverless-dev
      PolicyDocument: {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Action": "sts:assumeRole",
                  "Resource": "arn:aws:iam::${self:custom.account_number_dev}:role/OrganizationAccountAccessRole"
              }
          ]
      }

  OrganizationAccountAccessServerlessOpsDevUsersPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-dev-Users
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.account_number_dev}:role/OrganizationAccountAccessUserRole"
          }
        ]
      }

  OrganizationAccountAccessServerlessOpsDevAdminsPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      ManagedPolicyName: OrganizationAccountAccess-serverlessops-dev-Admins
      PolicyDocument: {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "sts:assumeRole",
            "Resource": "arn:aws:iam::${self:custom.account_number_dev}:role/OrganizationAccountAccessAdminRole"
          }
        ]
      }

Outputs:
  CloudFormationFullAccessArn:
    Description: Policy ARN
    Value:
      Ref: CloudFormationFullAccess
    Export:
      Name: ${self:service}-${self:provider.stage}-CloudFormationFullAccessArn

  # dev
  OrganizationAccountAccessServerlessOpsDevPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsDevPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevPolicyArn
  OrganizationAccountAccessServerlessOpsDevAdminPolicyArn:
     Description: Policy ARN
     Value:
       Ref: OrganizationAccountAccessServerlessOpsDevAdminsPolicy
     Export:
       Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevAdminPolicyArn
  OrganizationAccountAccessServerlessOpsDevUsersPolicyArn:
    Description: Policy ARN
    Value:
      Ref: OrganizationAccountAccessServerlessOpsDevUsersPolicy
    Export:
      Name: ${self:service}-${self:provider.stage}-OrganizationAccountAccessServerlessOpsDevUsersPolicyArn

